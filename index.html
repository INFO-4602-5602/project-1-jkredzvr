<html>
<head>
<title>Project 0</title>
<style type="text/css" href="project0.css"></style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<!--Put your D3 import statement between these two lines-->
    <!--<script src="https://d3js.org/d3.v5.min.js"></script>
    -->
    <script src="http://d3js.org/d3.v4.js" charset="utf-8"></script>    
<!--Put your D3 import statement between these two lines-->
</head>

<body>
	<div id="partOne">
        <h1>Part One: </h1>
        I've made a change!
	</div>
    
    <div id="partTwo">
        <h1>Part Two: </h1>
        <div id="barchart">
        </div>
	</div>
    
    <div id="partThree">
        <h1>Part Three &amp; Four: </h1>
        <div id="scatterplot">
            <p id="scatterLabel"></p>
        </div>
	</div>
    
    <div id="partFive">
        <h1>Part Five: </h1>
        <div id="scatterplotSet">
        </div>
	</div>
    
    <script type="text/javascript">
        // Put your part one code here ***********************
        d3.csv("./data/anscombe_I.csv", function(error,data){
            if(error) throw error;
            checkDataset(data)   
        });

        d3.csv("./data/anscombe_II.csv", function(error,data){
            if(error) throw error;
            checkDataset(data)   
        });
        d3.csv("./data/anscombe_III.csv", function(error,data){
            if(error) throw error;
            checkDataset(data)   
        });
        d3.csv("./data/anscombe_IV.csv", function(error,data){
            if(error) throw error;
            checkDataset(data)   
        });
        
        // Leave this to test your data uploading. All data uploading should be above this line
        function checkDataset(dataset) {
            console.log(dataset.length)
            if (dataset.length == 11)
                $("#partOne").append("<p>data loaded correctly</p>");
            else
                $("#partOne").append("<p>data loaded incorrectly. Try using the debugger to help you find the bug!</p>");
        }

        // Put your part two code here ***********************

        // First, we will create some constants to define non-data-related parts of the visualization
        var w = 700; // Width of our visualization
        var h = 500; // Height of our visualization
        var xOffset = 40; // Space for x-axis labels
        var yOffset = 100; // Space for y-axis labels
        var margin = 10; // Margin around visualization
        var vals = ['x', 'y']; // List of data attributes
        var xVal = vals[0]; // Value to plot on x-axis
        var yVal = vals[1]; // Value to plot on y-axis


        // set the dimensions and margins of the graph
        var margin = {top: 20, right:20, left:50, bottom:30};
        var width = 960 - margin.left - margin.right;
        var height = 500 - margin.top -margin.bottom;

        // set the ranges
        var x = d3.scaleLinear().range([0, width]);
        var y = d3.scaleLinear().range([height, 0]);  //position in the y (0,0) starts at the bottom left corner

        // append the svg obgect to the body of the page
        // appends a 'group' element to 'svg'
        // moves the 'group' element to the top left margin
        var svg = d3.select("#barchart").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform","translate("+margin.left + "," + margin.top +")");
            // add the text labels


        d3.csv("./data/anscombe_I.csv", function(error,data){
            if(error) throw error;
            // Scale the range of the data
            //+d[xVal] since the values are strings and min,max,extents sorts by natural ordering...
            x.domain(d3.extent(data, function(d) {
                return +d[xVal];}));

                // d3.extent(data, function(d) {
                // console.log("x:",d[xVal])
                // return d[xVal];}));
            y.domain([0, d3.max(data, function(d) {
                return +d[yVal];})]);  //apply a max function on all data

            // Add the scatterplot points
            svg.selectAll("circle")
                   .data(data)
               .enter()
               .append("circle")
               .attr("r",5)
               .attr("cx", function(d){return x(d[xVal]);})
               .attr("cy", function(d){return y(d[yVal]);})
               .attr("fill","lightblue");


            // Add the X Axis
            svg.append("g")
                .attr("transform","translate(0, "+ height+ ")")
                .call(d3.axisBottom(x));
            
            // Add the Y Axis
            svg.append("g") 
                .call(d3.axisLeft(y));

            //Add text labels
            var xLabel = svg.append("text")
                            .attr("class","label")
                            .text(xVal)
                            .attr("x", width - 20)
                            .attr("y", height -10);

            var yLabel = svg.append("text")
                            .attr("class","label")
                            .text(yVal)
                            .attr("y", -10)
                            .attr("transform", "rotate(90)")
                            .style("text-anchor","start")
        });  
        
        // A function to retrieve the next value in the vals list
        function getNextVal(val) {
            return vals[(vals.indexOf(val) + 1) % vals.length];
        };

        // A function to change what values we plot on the x-axis
        function setXval(val) {
            // Update xVal
            xVal = val;
            // Update the axis
            xScale.domain([d3.min(data, function(d) { return parseFloat(d[xVal]); })-1,
                           d3.max(data, function(d) { return parseFloat(d[xVal]); })+1])
            xAxis.scale(xScale);
            xAxisG.call(xAxis);
            xLabel.text(xVal);
            // Update the points

        };

        // A function to change what values we plot on the y-axis
        function setYval(val) {
            // Update yVal
            yVal = val;
            // Update the axis
            yScale.domain([d3.min(data, function(d) { return parseFloat(d[yVal]); })-1,
                           d3.max(data, function(d) { return parseFloat(d[yVal]); })+1])
            yAxis.scale(yScale);
            yAxisG.call(yAxis);
            yLabel.text(yVal);
        }; 
        // Put your part three & four code here ***********************
        var svg_linegraph = d3.select("#scatterplot").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform","translate("+margin.left + "," + margin.top +")");

        var line = d3.line()
                .x(function(d) { return x(d[xVal]); })
                .y(function(d) { return y(d[yVal]); });

        d3.csv("./data/anscombe_I.csv", function(error,data){
            if(error) throw error;
            
            //Sort the data by x column
            data.sort(function(a,b) {return b[xVal]-a[xVal];});

            // Scale the range of the data
            x.domain(d3.extent(data, function(d) {
                return +d[xVal];}));
            y.domain([0, d3.max(data, function(d) {
                return +d[yVal];})]);  //apply a max function on all data

            

            // Add the scatterplot points
            svg_linegraph.selectAll("circle")
                   .data(data)
               .enter()
               .append("circle")
               .attr("r",5)
               .attr("cx", function(d){return x(d[xVal]);})
               .attr("cy", function(d){return y(d[yVal]);})
               .attr("fill","lightblue");


            // Add the X Axis
            svg_linegraph.append("g")
                .attr("transform","translate(0, "+ height+ ")")
                .call(d3.axisBottom(x));
            
            // Add the Y Axis
            svg_linegraph.append("g") 
                .call(d3.axisLeft(y));

            //Add text labels
            var xLabel = svg_linegraph.append("text")
                            .attr("class","label")
                            .text(xVal)
                            .attr("x", width - 20)
                            .attr("y", height -10);

            var yLabel = svg_linegraph.append("text")
                            .attr("class","label")
                            .text(yVal)
                            .attr("y", -10)
                            .attr("transform", "rotate(90)")
                            .style("text-anchor","start")

            svg_linegraph.append("path")
                          .datum(data)
                          .attr("fill", "none")
                          .attr("stroke", "steelblue")
                          .attr("stroke-linejoin", "round")
                          .attr("stroke-linecap", "round")
                          .attr("stroke-width", 1.5)
                          .attr("d", line);
                            });

        //
        /*
        When you click on a point, change the paragraph with the id scatterLabel to print out the x and y values of that point.
        When you hover over a point, change itâ€™s color (and change it back when you mouse out!).
        */
        var svg_interactiveScatter = d3.select("#scatterplot").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform","translate("+margin.left + "," + margin.top +")");
            // add the text labels


        d3.csv("./data/anscombe_I.csv", function(error,data){
            if(error) throw error;
            // Scale the range of the data
            //+d[xVal] since the values are strings and min,max,extents sorts by natural ordering...
            x.domain(d3.extent(data, function(d) {
                return +d[xVal];}));

                // d3.extent(data, function(d) {
                // console.log("x:",d[xVal])
                // return d[xVal];}));
            y.domain([0, d3.max(data, function(d) {
                return +d[yVal];})]);  //apply a max function on all data

            // Add the scatterplot points
            svg_interactiveScatter.selectAll("circle")
               .data(data)
               .enter()
               .append("circle")
               .attr("r",5)
               .attr("cx", function(d){return x(d[xVal]);})
               .attr("cy", function(d){return y(d[yVal]);})
               .attr("fill","lightblue")
               //Hover Interactions
               .on("mouseover", handleMouseOver)
               .on("mouseout", handleMouseOut)
               .on("click", handleMouseClick);


            // Add the X Axis
            svg_interactiveScatter.append("g")
                .attr("transform","translate(0, "+ height+ ")")
                .call(d3.axisBottom(x));
            
            // Add the Y Axis
            svg_interactiveScatter.append("g") 
                .call(d3.axisLeft(y));

            //Add text labels
            var xLabel = svg.append("text")
                            .attr("class","label")
                            .text(xVal)
                            .attr("x", width - 20)
                            .attr("y", height -10);

            var yLabel = svg.append("text")
                            .attr("class","label")
                            .text(yVal)
                            .attr("y", -10)
                            .attr("transform", "rotate(90)")
                            .style("text-anchor","start")
        });


        var ori_size = 5
        var hover_size = 10
        var ori_color = 'lightblue'
        var hover_color = 'orange'
        // Create Event Handlers for mouse
        function handleMouseOver(d, i) {  // Add interactivity
            console.log("Your mouse went over", d, i);
            // Use D3 to select element, change color and size
            d3.select(this)
                .attr('r',hover_size)
                .attr('fill',hover_color);

            // Specify where to put label of text
            svg_interactiveScatter.append("text")
               .attr('id',"t" + d.x + "-" + d.y + "-" + i)  // Create an id for text so we can select it later for removing on mouseout
                .attr('x', function() { return x(d.x) - 30})
                .attr('y', function() { return y(d.y) - 15})
                .text(function() {
                    return [d.x, d.y];  // Value of the text
                });
        }

        function handleMouseOut(d, i) {
            // Use D3 to select element, change color back to normal
            d3.select(this)
                .attr('r',ori_size)
                .attr('fill',ori_color);

            // Select text by id and then remove
            console.log(d.x)
            console.log(d.y)
            d3.select("[id='t" + d.x + "-" + d.y + "-" + i+"']").remove();  // Remove text location
        }

        function handleMouseClick(d, i) {
            //Change scatterLabel <p> to show x and y value
            d3.select("#scatterLabel").text("Selected x: "+d.x+" , Selected y: "+d.y);
        }




        // Put your part five code here ***********************
        
    </script>
</body>


</html>